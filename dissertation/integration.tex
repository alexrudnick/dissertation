\chapter{Integration Into Machine Translation Systems}
\label{chap:integration}

In this chapter, I discuss how the Chipa software, along with its extensions
developed in the previous chapters, can be integrated into running machine
translation systems, with the goal of improving lexical selection in practice.
Subsequently, we cover Chipa's effect on MT quality over a variety of test
sets, translating from Spanish into Guarani, Quechua, and English.

A hyperparameter that we need to check is: what's the minimum number of tokens
we train a classifier, before it does us any good?
More common word types are going to be both easier to train and have more
impact on the test sentences that we want to translate, presumably. But if our
classifiers are in fact helpful, then having classifications for more input
tokens is going to be helpful.
So we should try a number of settings for this parameter.

\section{Integrating Chipa into Phrase-Based Statistical Machine Translation}
\label{sec:terere}

We're probably actually going to do Phrasal here; it's probably easier to add
features to a Java program...
We built a baseline phrase-based SMT system with Phrasal, for simplicity and
comparability with other approaches.

Moses \cite{koehn-EtAl:2007:PosterDemo} is a mature, well-maintained and
popular statistical machine translation package, used by researchers and for
practical purposes around the world.

We refer to this combination of the Moses decoder with the Chipa CL-WSD
software as Tereré
\footnote{\url{http://github.com/alexrudnick/terere}
Tereré is a cold variety of yerba mate brewed with ice water; it is a
specifically Paraguayan specialty.}.

This works through adding an additional feature function to the Moses
phrase-based decoder. During the search through the space of possible
translations, Moses proposes candidate translations for each source word to
Chipa, which provides a score based on how likely the translation seems to the
CL-WSD system, based on the entire source-language sentence context. This score
is returned to Moses, which combines all of the available features in a
log-linear combination.

Then the weights for all of the features provided to the system (translation
probabilities, LM scores, CL-WSD scores, and perhaps others) can be tuned with
MERT \cite{och:2003:ACL}; thus, if CL-WSD scores turn out to be useful for
achieving high BLEU scores on the development set sentences, Chipa's feature
function will be afforded a higher weight. If not, its advice could carry less
weight, than, for example, that of the language model.

\subsection{Interfacing between Phrasal and Chipa}
%% XXX: this is probably way too complicated -- can't we just annotate the
%% phrase table for individual sentences just before decoding?
We implemented a simple protocol for communication between the Moses C++ code
and the Chipa server, based on Unix pipes. In earlier work with SQUOIA
\cite{rudnick:saltmil2014}, we had communicated between Chipa and the machine
translation system with XML-RPC \footnote{\url{http://xmlrpc.scripting.com/}},
but for simplicity (and honestly, difficulties using the Moses build system),
we built a new text-based protocol.

Named Unix pipes, or FIFOs, allow the creation of a special kind of filesystem
object whereby messages can be passed between processes in the same computer.
Here Moses requests an evaluation for a certain translation of a
source-language phrase, and Chipa returns a score based on how likely it
considers that phrase.

\section{SQUOIA}
SQUOIA\footnote{Described in detail at
\url{http://www.cl.uzh.ch/research/maschinelleuebersetzung/hybridmt_en.html}; 
Code available at \url{https://github.com/a-rios/squoia}}
is a project for MT from Spanish to Quechua.

SQUOIA is being developed by a team at the University of Zurich. For the most
part, it is a classical rule-based transfer system, although the team has
recently developed techniques for predicting verb morphology with machine
learning methods, in cases when rules cannot reliably disambiguate
\cite{riosgonzales-gohring:2013:HyTra}. It does not currently use machine
learning for lexical selection, although we have been in contact with the team
and are planning to collaborate to add CL-WSD features.

SQUOIA's architecture is based on the Matxin system \cite{matxin2005}, which
was originally intended for translating from Spanish to Basque.
It consists of a pipeline of scripts, each of which passes along a tree
describing the current input sentence, in XML form. Adding CL-WSD to this
system will involve adding another script somewhere in the pipeline that
extracts features from the current annotated sentence, makes lexical choices,
and then passes these choices to subsequent scripts.

The core system relies on a classical transfer approach and is mostly
rule-based, with a few components based on machine learning.
SQUOIA uses a pipeline approach, both in an abstract architectural sense and in
the sense that its pieces are instantiated as a series of scripts that communicate
via UNIX pipes. Each module performs some transformation on its input and
passes along the updated version to the next stage. Many modules focus on very
particular parts of the representation, leaving most of their input unchanged.

Rios and G\"{o}hring \cite{riosgonzales-gohring:2013:HyTra} describe
earlier work on extending the SQUOIA MT system with machine learning modules.

\section{Integrating Chipa into SQUOIA}

Lexical ambiguity is a significant problem facing rule-based machine
translation systems, as many words have several possible translations in a
given target language, each of which can be considered a sense of the word from
the source language.
The difficulty of resolving these ambiguities is mitigated for 
statistical machine translation systems for language pairs with large bilingual
corpora, as large n-gram language models and phrase tables containing common
multi-word expressions can encourage coherent word choices.
For most language pairs these resources are not available, so a primarily
rule-based approach becomes attractive.
In cases where some training data is available, though, we can
investigate hybrid RBMT and machine learning approaches, leveraging small and
potentially growing bilingual corpora. In this paper we
describe the integration of statistical cross-lingual word-sense disambiguation
software with SQUOIA, an existing rule-based MT system for the Spanish-Quechua
language pair, and show how it allows us to learn from the available bitext to
make better lexical choices, with very few code changes to the base system. We
also describe Chipa, the new open source CL-WSD software used for these
experiments.

The integration enables SQUOIA to take advantage of any available bitext
without significantly changing its design, and to improve its word choices as
additional bitext becomes available.

In its current design, SQUOIA makes word choices based on its bilingual
lexicon; the possible translations for a given word or multi-word expression
are retrieved from a dictionary on demand. If there are several possible
translations for a lexical item, these are passed along the pipeline so
that later stages can make a decision, but if the ambiguity persists,
then the first entry retrieved from the lexicon is selected. While there are
some rules for lexical selection, they have been written by hand and only cover
a small subset of the vocabulary in a limited number of contexts.

In this work, we supplement these rules with classifiers learned from
Spanish-Quechua bitext.
These classifiers make use of regularities that may not
be obvious to human rule-writers, providing improved lexical selection for
any word type that has adequate coverage in the training corpus.

There are many dialects of Quechua; SQUOIA focuses on the
Cuzco dialect, spoken around the Peruvian city of Cuzco.

In the first stages, Spanish source sentences are analyzed with off-the-shelf
open-source NLP tools. To analyze the input Spanish text,
SQUOIA uses FreeLing \cite{padro12} for morphological analysis and named-entity
recognition,
Wapiti \cite{lavergne2010practical} for tagging,
and DeSr \cite{attardi-EtAl:2007:EMNLP-CoNLL2007} for parsing.
All of these modules rely on statistical models.

In the next step, the Spanish verbs must be disambiguated in order to assign
them a Quechua verb form for generation: a rule-based module tries to assign a
verb form to each verb chunk based on contextual information. If the rules fail to
do so due to parsing or tagging errors, the verb is marked as ambiguous and
passed on to an SVM classifier, which assigns a verb form even if the context
of that verb does not unambiguously select a target form. This is among the
most difficult parts of the
translation process, as the grammatical categories encoded in verbs differ
substantially between Spanish and Quechua. In the next step, a lexical transfer
module inserts all possible translations for every word from a bilingual dictionary.
Then a set of rules disambiguates the forms with lexical or morphological
ambiguities. However, this rule-based lexical disambiguation is very limited,
as it is not feasible to cover all possible contexts for every ambiguous word
with rules.

The rest of the system makes use of a classical transfer procedure. A following module
moves syntactic information between the nodes and the chunks in the tree, and
finally, the tree is reordered according to the basic word order in the target
language. In the last step, the Quechua surface forms are morphologically
generated through a finite state transducer.

In order to integrate Chipa into SQUOIA, we added an additional lexical
selection stage to the SQUOIA pipeline, occurring after the rule-based
disambiguation modules. This new module connects to the Chipa server to request
translation suggestions -- possibly several per word, ranked by their
probability estimates -- then looks for words that SQUOIA currently has marked
as ambiguous.

For each word with multiple translation possibilities, we consider each of the
translations known to SQUOIA and take the one ranked most highly in the
results from the classifiers. If there are no such overlapping translations, we
take the default entry suggested by SQUOIA's dictionary.
Notably, since Chipa and SQUOIA do not share the same lexicon and bitext alignments
may be noisy, translations
observed in the bitext may be unknown to the SQUOIA system, and lexical entries in the
SQUOIA dictionary may not be attested in the training data.


\section{Translation Evaluation}
In order to evaluate the effect of Chipa on lexical selection in a live
translation task, we used SQUOIA to translate two Spanish passages for which we
had reference Quechua translations.

The first is simply a thousand sentences
from the Bible; the second is adapted from the Peruvian government's public
advocacy website,\footnote{\emph{Defensoría del Pueblo},
\url{http://www.defensoria.gob.pe/quechua.php}} which is bilingual.
We collected and hand-aligned thirty-five sentences from this site.

%% XXX: this is probably not a good test set; we need to pick a better one.
%% Maybe also just sample some sentences from the Bible.
